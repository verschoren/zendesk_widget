<!doctype html>
<html class="h-full">
<head>
    <meta charset="UTF-8">
    <title>Internal Note - Zendesk Messaging Authentication</title>
    <meta name="description" content="Demo page to showcase the JWT Authentication for Zendesk Messaging">
    <meta name="keywords" content="zendesk, messaging, authentication, jwt, internal note">
    <meta name="author" content="Internal Note">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://widget.internalnote.com/img/banner.png">

    <link href="css/style.css" rel="stylesheet">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="js/view.js"></script>
    <script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=e125418a-9466-44d8-9b3f-2ac10e911ea4"> </script>
    <script defer data-domain="jwt.internalnote.com, widget.internalnote.com" src="https://plausible.io/js/script.js"></script>
</head>
<body class="h-full" data-name="messaging">
    <header>  
        <div class="mx-auto max-w-7xl py-6 px-4 sm:px-6 lg:px-8">
            <div class="md:flex md:items-center md:justify-between md:space-x-5">
                <div class="">
                    <h1 class="text-3xl font-bold tracking-tight text-gray-900">Zendesk Messaging Authentication</h1>
                    <h2 class="mt-2 text-xl tracking-tight text-gray-500">Demo page to showcase the JWT Authentication for Zendesk Messaging</h2>
                </div>
                <div class="justify-stretch mt-6 flex flex-col-reverse space-y-4 space-y-reverse sm:flex-row-reverse sm:justify-end sm:space-y-0 sm:space-x-3 sm:space-x-reverse md:mt-0 md:flex-row md:space-x-3">
                    <a href="https://widget.internalnote.com/guide_messaging/" target="_blank" class="inline-flex items-center justify-center rounded-md border border-indigo-600 bg-white px-4 py-2 text-sm font-medium text-indigo-600">Guide Embed</a>
                    <a href="https://internalnote.com/jwt-messaging/" target="_blank" class="inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-100">Read more</a>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="mx-auto max-w-7xl py-6 sm:px-6 lg:px-8">
            <div class="max-w-3xl mx-auto py-10 px-4 sm:px-6 lg:py-12 lg:px-8">
                <form class="space-y-8 divide-y divide-y-blue-gray-200">
                    <div class="grid grid-cols-1 gap-y-6 sm:grid-cols-6 sm:gap-x-6">
                        <div class="sm:col-span-6">
                            <h2 class="text-xl font-medium text-blue-gray-900">User Info</h2>
                            <p class="mt-1 text-sm text-blue-gray-500">Fill in this form to authenticate with one of the examples below or a random user.</p>
                        </div>

                        <div class="sm:col-span-6">
                            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                                <div data-target="user" class="profile relative flex items-center space-x-3 rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2 hover:border-gray-400">
                                    <div class="flex-shrink-0">
                                        <img class="h-10 w-10 rounded-full" src="img/regular.png" alt="">
                                    </div>
                                    <div class="min-w-0 flex-1">
                                        <span class="absolute inset-0" aria-hidden="true"></span>
                                        <p class="text-sm font-medium text-gray-900">
                                            Maximus
                                            <span class="inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-600/20">End User</span>
                                        </p>
                                        <p class="truncate text-sm text-gray-500">maximus@gladiator.example</p>                                    
                                    </div>
                                </div>
                                <div data-target="vip" class="profile relative flex items-center space-x-3 rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2 hover:border-gray-400">
                                    <div class="flex-shrink-0">
                                        <img class="h-10 w-10 rounded-full" src="img/godfather.png" alt="">
                                    </div>
                                    <div class="min-w-0 flex-1">
                                        <span class="absolute inset-0" aria-hidden="true"></span>
                                        <p class="text-sm font-medium text-gray-900">
                                            Vito Corleone
                                            <span class="inline-flex items-center rounded-full bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">VIP</span>
                                        </p>
                                        <p class="truncate text-sm text-gray-500">vito@corleone.example</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        

                        <div class="sm:col-span-3">
                            <label for="name" class="block text-sm font-medium text-blue-gray-900">Name </label>
                            <input type="text" name="name" id="name" value="John Smith" autocomplete="given-name" class="mt-1 block w-full border-blue-gray-300 rounded-md shadow-sm text-blue-gray-900 sm:text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="sm:col-span-3">
                            <label for="email" class="block text-sm font-medium text-blue-gray-900"> Email</label>
                            <input type="email" name="email" id="email" value="john@example.com" autocomplete="email" class="mt-1 block w-full border-blue-gray-300 rounded-md shadow-sm text-blue-gray-900 sm:text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="sm:col-span-6">
                            <label for="username" class="block text-sm font-medium text-blue-gray-900"> External ID </label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-blue-gray-300 bg-blue-gray-50 text-blue-gray-500 sm:text-sm"> UUID</span>
                                <input type="text" readonly name="external_id" id="external_id" autocomplete="username" value="" class="flex-1 block w-full min-w-0 border-blue-gray-300 rounded-none rounded-r-md text-blue-gray-900 sm:text-sm focus:ring-gray-50 focus:border-blue-gray-300  bg-gray-50">
                            </div>
                        </div>
                    </div>

                    <div class="pt-8 flex justify-end">
                        <button type="button" onclick="Logout()" id="logout" class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-blue-gray-900 hover:bg-blue-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Logout</button>
                        <button type="button" onclick="Login()" id="login" class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Login</button>
                    </div>
                </form>

                <div id="login_ok" style="display:none" class="rounded-md bg-green-50 p-4 mt-8">
                    <div class="flex">
                    <div class="flex-shrink-0">
                        <!-- Heroicon name: solid/check-circle -->
                        <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-green-800">User logged in</h3>
                        <div class="mt-2 text-sm text-green-700">
                        <p>We've succesfully logged in and authenticated your user.</p>
                        </div>
                    </div>
                    </div>
                </div>
                <div id="logout_ok" style="display:none" class="rounded-md bg-red-50 p-4 mt-8">
                    <div class="flex">
                    <div class="flex-shrink-0">
                        <!-- Heroicon name: solid/x-circle -->
                        <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">User logged out</h3>
                        <div class="mt-2 text-sm text-red-700">
                            <p>We've succesfully logged out.</p>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
  </body>
</html>

<script type="text/javascript">
    //when clicked on .profile fill in name and email fields
    $('.profile').click(function(){
        var target = $(this).attr('data-target');
        if (target == 'user'){
            $('#name').val('Maximus Decimus Meridius');
            $('#email').val('>maximus@gladiator.example');
        }
        if (target == 'vip'){
            $('#name').val('Vito Corleone');
            $('#email').val('vito@corleone.example');
        }
    });
    function Logout(){
        console.log("user logged out");
        zE('messenger', 'logoutUser');
        $('#logout_ok').show();
        $('#login_ok').hide();
    }

    function Login(){
        $('#external_id').val('user_'+$('#email').val());
        var user = {
            name: $('#name').val(),
            email: $('#email').val(),
            external_id: 'user_'+$('#email').val()
        }        
        console.log("User logged in", user);

        //get token for current user
        var jwttoken = '';
        $.ajax({
            type: "POST",
            url: 'https://jwtauth.internalnote.com/messaging', //replace with your worker
            data: JSON.stringify({ "external_id": user.external_id, "user_email": user.email, "user_name": user.name }),
            dataType: 'text',
            async: false,
            success: function (json) {
                jwttoken = json;
                $('#login_ok').show();
                $('#logout_ok').hide();
            }
        });
        console.log(jwttoken)

        //authenticate messaging
        zE('messenger', 'loginUser', function (callback) {
            callback(jwttoken);
        });
    }
</script>

<script type="text/javascript">
    $(function() {
      //check for URL parameter called "voice" and if it is set, open the voice channel
      var urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('voice')) {
        zE('messenger:open', 'voice', '6c0e70e6ef77d7a711a073f249ab6304')
      }
    }); 
  </script>
